/* Maplibre GL inspect JS */ !function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).MaplibreInspect=t()}(this,function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var r={exports:{}};r.exports,function(t,r){var n="__lodash_hash_undefined__",o="[object Arguments]",i="[object Array]",s="[object Boolean]",a="[object Date]",u="[object Error]",c="[object Function]",l="[object Map]",p="[object Number]",h="[object Object]",f="[object Promise]",$="[object RegExp]",d="[object Set]",g="[object String]",y="[object WeakMap]",v="[object ArrayBuffer]",b="[object DataView]",_=/^\[object .+?Constructor\]$/,m=/^(?:0|[1-9]\d*)$/,k={};k["[object Float32Array]"]=k["[object Float64Array]"]=k["[object Int8Array]"]=k["[object Int16Array]"]=k["[object Int32Array]"]=k["[object Uint8Array]"]=k["[object Uint8ClampedArray]"]=k["[object Uint16Array]"]=k["[object Uint32Array]"]=!0,k[o]=k[i]=k[v]=k[s]=k[b]=k[a]=k[u]=k[c]=k[l]=k[p]=k[h]=k[$]=k[d]=k[g]=k[y]=!1;var w="object"==typeof e&&e&&e.Object===Object&&e,j="object"==typeof self&&self&&self.Object===Object&&self,S=w||j||Function("return this")(),C=r&&!r.nodeType&&r,M=C&&t&&!t.nodeType&&t,I=M&&M.exports===C,P=I&&w.process,O=function(){try{return P&&P.binding&&P.binding("util")}catch(e){}}(),A=O&&O.isTypedArray;function z(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function x(e,t){return e.has(t)}function L(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r}function R(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}var T,B,E,F=Array.prototype,H=Function.prototype,N=Object.prototype,U=S["__core-js_shared__"],D=H.toString,G=N.hasOwnProperty,q=(T=/[^.]+$/.exec(U&&U.keys&&U.keys.IE_PROTO||""))?"Symbol(src)_1."+T:"",V=N.toString,W=RegExp("^"+D.call(G).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),J=I?S.Buffer:void 0,X=S.Symbol,K=S.Uint8Array,Q=N.propertyIsEnumerable,Y=F.splice,Z=X?X.toStringTag:void 0,ee=Object.getOwnPropertySymbols,et=J?J.isBuffer:void 0,er=(B=Object.keys,E=Object,function(e){return B(E(e))}),en=e3(S,"DataView"),eo=e3(S,"Map"),ei=e3(S,"Promise"),es=e3(S,"Set"),ea=e3(S,"WeakMap"),eu=e3(Object,"create"),ec=eM(en),el=eM(eo),ep=eM(ei),eh=eM(es),ef=eM(ea),e$=X?X.prototype:void 0,ed=e$?e$.valueOf:void 0;function eg(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function e8(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function ey(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function ev(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new ey;++t<r;)this.add(e[t])}function eb(e){var t=this.__data__=new e8(e);this.size=t.size}function e_(e,t){for(var r=e.length;r--;)if(e6(e[r][0],t))return r;return -1}function em(e){var t;return null==e?void 0===e?"[object Undefined]":"[object Null]":Z&&Z in Object(e)?function e(t){var r=G.call(t,Z),n=t[Z];try{t[Z]=void 0;var o=!0}catch(i){}var s=V.call(t);return o&&(r?t[Z]=n:delete t[Z]),s}(e):(t=e,V.call(t))}function ek(e){return eA(e)&&em(e)==o}function ew(e,t,r,n,o,i){var s=1&r,a=e.length,u=t.length;if(a!=u&&!(s&&u>a))return!1;var c=i.get(e);if(c&&i.get(t))return c==t;var l=-1,p=!0,h=2&r?new ev:void 0;for(i.set(e,t),i.set(t,e);++l<a;){var f=e[l],$=t[l];if(n)var d=s?n($,f,l,t,e,i):n(f,$,l,e,t,i);if(void 0!==d){if(d)continue;p=!1;break}if(h){if(!z(t,function(e,t){if(!x(h,t)&&(f===e||o(f,e,r,n,i)))return h.push(t)})){p=!1;break}}else if(!(f===$||o(f,$,r,n,i))){p=!1;break}}return i.delete(e),i.delete(t),p}function e0(e){var t,r,n,o;return t=e,r=ex,n=eS,o=r(t),e1(t)?o:function e(t,r){for(var n=-1,o=r.length,i=t.length;++n<o;)t[i+n]=r[n];return t}(o,n(t))}function ej(e,t){var r,n,o=e.__data__;return(r=t,n=typeof r,"string"==n||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof t?"string":"hash"]:o.map}function e3(e,t){var r,n,o,i,s=(r=e,n=t,null==r?void 0:r[n]);return(o=s,eO(o)&&(i=o,!q||!(q in i))&&(eP(o)?W:_).test(eM(o)))?s:void 0}eg.prototype.clear=function e(){this.__data__=eu?eu(null):{},this.size=0},eg.prototype.delete=function e(t){var r=this.has(t)&&delete this.__data__[t];return this.size-=r?1:0,r},eg.prototype.get=function e(t){var r=this.__data__;if(eu){var o=r[t];return o===n?void 0:o}return G.call(r,t)?r[t]:void 0},eg.prototype.has=function e(t){var r=this.__data__;return eu?void 0!==r[t]:G.call(r,t)},eg.prototype.set=function e(t,r){var o=this.__data__;return this.size+=this.has(t)?0:1,o[t]=eu&&void 0===r?n:r,this},e8.prototype.clear=function e(){this.__data__=[],this.size=0},e8.prototype.delete=function e(t){var r=this.__data__,n=e_(r,t);return!(n<0)&&(n==r.length-1?r.pop():Y.call(r,n,1),--this.size,!0)},e8.prototype.get=function e(t){var r=this.__data__,n=e_(r,t);return n<0?void 0:r[n][1]},e8.prototype.has=function e(t){return e_(this.__data__,t)>-1},e8.prototype.set=function e(t,r){var n=this.__data__,o=e_(n,t);return o<0?(++this.size,n.push([t,r])):n[o][1]=r,this},ey.prototype.clear=function e(){this.size=0,this.__data__={hash:new eg,map:new(eo||e8),string:new eg}},ey.prototype.delete=function e(t){var r=ej(this,t).delete(t);return this.size-=r?1:0,r},ey.prototype.get=function e(t){return ej(this,t).get(t)},ey.prototype.has=function e(t){return ej(this,t).has(t)},ey.prototype.set=function e(t,r){var n=ej(this,t),o=n.size;return n.set(t,r),this.size+=n.size==o?0:1,this},ev.prototype.add=ev.prototype.push=function e(t){return this.__data__.set(t,n),this},ev.prototype.has=function e(t){return this.__data__.has(t)},eb.prototype.clear=function e(){this.__data__=new e8,this.size=0},eb.prototype.delete=function e(t){var r=this.__data__,n=r.delete(t);return this.size=r.size,n},eb.prototype.get=function e(t){return this.__data__.get(t)},eb.prototype.has=function e(t){return this.__data__.has(t)},eb.prototype.set=function e(t,r){var n=this.__data__;if(n instanceof e8){var o=n.__data__;if(!eo||o.length<199)return o.push([t,r]),this.size=++n.size,this;n=this.__data__=new ey(o)}return n.set(t,r),this.size=n.size,this};var eS=ee?function(e){return null==e?[]:function e(t,r){for(var n=-1,o=null==t?0:t.length,i=0,s=[];++n<o;){var a=t[n];r(a,n,t)&&(s[i++]=a)}return s}(ee(e=Object(e)),function(t){return Q.call(e,t)})}:eL,e4=em;function eC(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||m.test(e))&&e>-1&&e%1==0&&e<t}function eM(e){if(null!=e){try{return D.call(e)}catch(t){}try{return e+""}catch(r){}}return""}function e6(e,t){return e===t||e!=e&&t!=t}(en&&e4(new en(new ArrayBuffer(1)))!=b||eo&&e4(new eo)!=l||ei&&e4(ei.resolve())!=f||es&&e4(new es)!=d||ea&&e4(new ea)!=y)&&(e4=function(e){var t=em(e),r=t==h?e.constructor:void 0,n=r?eM(r):"";if(n)switch(n){case ec:return b;case el:return l;case ep:return f;case eh:return d;case ef:return y}return t});var eI=ek(function(){return arguments}())?ek:function(e){return eA(e)&&G.call(e,"callee")&&!Q.call(e,"callee")},e1=Array.isArray,e7=et||eR;function eP(e){if(!eO(e))return!1;var t=em(e);return t==c||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}function e2(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}function eO(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function eA(e){return null!=e&&"object"==typeof e}var e5,ez=A?(e5=A,function(e){return e5(e)}):function e(t){return eA(t)&&e2(t.length)&&!!k[em(t)]};function ex(e){var t;return null!=(t=e)&&e2(t.length)&&!eP(t)?function e(t,r){var n=e1(t),o=!n&&eI(t),i=!n&&!o&&e7(t),s=!n&&!o&&!i&&ez(t),a=n||o||i||s,u=a?function e(t,r){for(var n=-1,o=Array(t);++n<t;)o[n]=r(n);return o}(t.length,String):[],c=u.length;for(var l in t)G.call(t,l)&&!(a&&("length"==l||i&&("offset"==l||"parent"==l)||s&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||eC(l,c)))&&u.push(l);return u}(e):function e(t){if(r=t,n=r&&r.constructor,r!==("function"==typeof n&&n.prototype||N))return er(t);var r,n,o=[];for(var i in Object(t))G.call(t,i)&&"constructor"!=i&&o.push(i);return o}(e)}function eL(){return[]}function eR(){return!1}t.exports=function e(t,r){return function e(t,r,n,c,f){return t===r||(null!=t&&null!=r&&(eA(t)||eA(r))?function e(t,r,n,c,f,y){var _=e1(t),m=e1(r),k=_?i:e4(t),w=m?i:e4(r);k=k==o?h:k,w=w==o?h:w;var j=k==h,S=w==h,C=k==w;if(C&&e7(t)){if(!e7(r))return!1;_=!0,j=!1}if(C&&!j)return y||(y=new eb),_||ez(t)?ew(t,r,n,c,f,y):function e(t,r,n,o,i,c,h){switch(n){case b:if(t.byteLength!=r.byteLength||t.byteOffset!=r.byteOffset)break;t=t.buffer,r=r.buffer;case v:if(t.byteLength!=r.byteLength||!c(new K(t),new K(r)))break;return!0;case s:case a:case p:return e6(+t,+r);case u:return t.name==r.name&&t.message==r.message;case $:case g:return t==r+"";case l:var f=L;case d:var y=1&o;if(f||(f=R),t.size!=r.size&&!y)break;var _=h.get(t);if(_)return _==r;o|=2,h.set(t,r);var m=ew(f(t),f(r),o,i,c,h);return h.delete(t),m;case"[object Symbol]":if(ed)return ed.call(t)==ed.call(r)}return!1}(t,r,k,n,c,f,y);if(!(1&n)){var M=j&&G.call(t,"__wrapped__"),I=S&&G.call(r,"__wrapped__");if(M||I){var P=M?t.value():t,O=I?r.value():r;return y||(y=new eb),f(P,O,n,c,y)}}return!!C&&(y||(y=new eb),function e(t,r,n,o,i,s){var a=1&n,u=e0(t),c=u.length,l=e0(r).length;if(c!=l&&!a)return!1;for(var p=c;p--;){var h=u[p];if(!(a?h in r:G.call(r,h)))return!1}var f=s.get(t);if(f&&s.get(r))return f==r;var $=!0;s.set(t,r),s.set(r,t);for(var d=a;++p<c;){var g=t[h=u[p]],y=r[h];if(o)var v=a?o(y,g,h,r,t,s):o(g,y,h,t,r,s);if(!(void 0===v?g===y||i(g,y,n,o,s):v)){$=!1;break}d||(d="constructor"==h)}if($&&!d){var b=t.constructor,_=r.constructor;b!=_&&"constructor"in t&&"constructor"in r&&!("function"==typeof b&&b instanceof b&&"function"==typeof _&&_ instanceof _)&&($=!1)}return s.delete(t),s.delete(r),$}(t,r,n,c,f,y))}(t,r,void 0,void 0,e,void 0):t!=t&&r!=r)}(t,r)}}(r,r.exports);var n=t(r.exports);function o(e,t,r){let n={source:t,type:"circle",paint:{"circle-color":e,"circle-radius":2},layout:{visibility:"visible"},filter:["==","$type","Point"]};return r?(n["source-layer"]=r,n.id=[t,r,"circle"].join("_")):n.id=[t,"circle"].join("_"),n}function i(e,t,r){let n={source:t,type:"fill",paint:{"fill-color":e,"fill-antialias":!0,"fill-outline-color":e},layout:{visibility:"visible"},filter:["==","$type","Polygon"]};return r?(n["source-layer"]=r,n.id=[t,r,"polygon"].join("_")):n.id=[t,"polygon"].join("_"),n}function s(e,t,r){let n={source:t,type:"line",paint:{"line-color":e},layout:{"line-join":"round","line-cap":"round",visibility:"visible"},filter:["==","$type","LineString"]};return r?(n["source-layer"]=r,n.id=[t,r,"line"].join("_")):n.id=[t,"line"].join("_"),n}var a={polygonLayer:i,lineLayer:s,circleLayer:o,generateInspectStyle:function e(t,r,n){n=Object.assign({backgroundColor:"#fff"},n);let o={id:"background",type:"background",paint:{"background-color":n.backgroundColor}},i={};return Object.keys(t.sources).forEach(e=>{let r=t.sources[e];("vector"===r.type||"geojson"===r.type)&&(i[e]=r)}),Object.assign(t,{layers:[o].concat(r),sources:i})},generateColoredLayers:function e(t,r){let n=[],a=[],u=[];function c(e){return{circle:r(e,.8),line:r(e,.6),polygon:r(e,.3)}}return Object.keys(t).forEach(e=>{let r=t[e];if(r&&0!==r.length)r.forEach(t=>{let r=c(t);a.push(o(r.circle,e,t)),u.push(s(r.line,e,t)),n.push(i(r.polygon,e,t))});else{let l=c(e);a.push(o(l.circle,e)),u.push(s(l.line,e)),n.push(i(l.polygon,e))}}),n.concat(u).concat(a)}};function u(e,t){var r;return`<div class="maplibregl-inspect_property"><div class="maplibregl-inspect_property-name">${e}</div><div class="maplibregl-inspect_property-value">${null==(r=t)?r:r instanceof Date?r.toLocaleString():"object"==typeof r||"number"==typeof r||"string"==typeof r?r.toString():r}</div></div>`}function c(e){return`<div class="maplibregl-inspect_layer">${e}</div>`}var l,p,h,f,$,d={exports:{}};l=d,p=d.exports,$=(f=function(){var e=null,t={};s("monochrome",null,[[0,0],[100,0],]),s("red",[-26,18],[[20,100],[30,92],[40,89],[50,85],[60,78],[70,70],[80,60],[90,55],[100,50],]),s("orange",[18,46],[[20,100],[30,93],[40,88],[50,86],[60,85],[70,70],[100,70],]),s("yellow",[46,62],[[25,100],[40,94],[50,89],[60,86],[70,84],[80,82],[90,80],[100,75],]),s("green",[62,178],[[30,100],[40,90],[50,85],[60,81],[70,74],[80,64],[90,50],[100,40],]),s("blue",[178,257],[[20,100],[30,86],[40,80],[50,74],[60,60],[70,52],[80,44],[90,39],[100,35],]),s("purple",[257,282],[[20,100],[30,87],[40,79],[50,70],[60,65],[70,59],[80,52],[90,45],[100,42],]),s("pink",[282,334],[[20,100],[30,90],[40,86],[60,84],[80,80],[90,75],[100,73],]);var r=[],n=function(s){if(void 0!==(s=s||{}).seed&&null!==s.seed&&s.seed===parseInt(s.seed,10))e=s.seed;else if("string"==typeof s.seed)e=function e(t){for(var r=0,n=0;n!==t.length&&!(r>=Number.MAX_SAFE_INTEGER);n++)r+=t.charCodeAt(n);return r}(s.seed);else if(void 0!==s.seed&&null!==s.seed)throw TypeError("The seed value must be an integer or string");else e=null;if(null!==s.count&&void 0!==s.count){for(var l,p,h,f=s.count,$=[],d=0;d<s.count;d++)r.push(!1);for(s.count=null;f>$.length;){var g=n(s);null!==e&&(s.seed=e),$.push(g)}return s.count=f,$}return p=function e(t,r){if("monochrome"===r.hue)return 0;if("random"===r.luminosity)return i([0,100]);var n,s=(n=t,o(n).saturationRange),a=s[0],u=s[1];switch(r.luminosity){case"bright":a=55;break;case"dark":a=u-10;break;case"light":u=55}return i([a,u])}(l=function e(n){if(r.length>0){var s,a=function e(r){if(isNaN(r)){if("string"==typeof r){if(t[r]){var n=t[r];if(n.hueRange)return n.hueRange}else if(r.match(/^#?([0-9A-F]{3}|[0-9A-F]{6})$/i)){var i=u(r)[0];return o(i).hueRange}}}else{var s=parseInt(r);if(s<360&&s>0)return o(r).hueRange}return[0,360]}(n.hue),c=i(a),l=(a[1]-a[0])/r.length,p=parseInt((c-a[0])/l);return!0===r[p]?p=(p+2)%r.length:r[p]=!0,(c=i(a=[(a[0]+p*l)%359,(a[0]+(p+1)*l)%359]))<0&&(c=360+c),c}var a=function e(r){if("number"==typeof parseInt(r)){var n=parseInt(r);if(n<360&&n>0)return[n,n]}if("string"==typeof r){if(t[r]){var o=t[r];if(o.hueRange)return o.hueRange}else if(r.match(/^#?([0-9A-F]{3}|[0-9A-F]{6})$/i)){var i=u(r)[0];return[i,i]}}return[0,360]}(n.hue);return(c=i(a))<0&&(c=360+c),c}(s),s),h=function e(t,r,n){var s=function e(t,r){for(var n=o(t).lowerBounds,i=0;i<n.length-1;i++){var s=n[i][0],a=n[i][1],u=n[i+1][0],c=n[i+1][1];if(r>=s&&r<=u){var l=(c-a)/(u-s),p=a-l*s;return l*r+p}}return 0}(t,r),a=100;switch(n.luminosity){case"dark":a=s+20;break;case"light":s=(a+s)/2;break;case"random":s=0,a=100}return i([s,a])}(l,p,s),function e(t,r){switch(r.format){case"hsvArray":return t;case"hslArray":return c(t);case"hsl":var n=c(t);return"hsl("+n[0]+", "+n[1]+"%, "+n[2]+"%)";case"hsla":var o=c(t),i=r.alpha||Math.random();return"hsla("+o[0]+", "+o[1]+"%, "+o[2]+"%, "+i+")";case"rgbArray":return a(t);case"rgb":return"rgb("+a(t).join(", ")+")";case"rgba":var s=a(t),i=r.alpha||Math.random();return"rgba("+s.join(", ")+", "+i+")";default:return function e(t){var r=a(t);function n(e){var t=e.toString(16);return 1==t.length?"0"+t:t}return"#"+n(r[0])+n(r[1])+n(r[2])}(t)}}([l,p,h],s)};function o(e){for(var r in e>=334&&e<=360&&(e-=360),t){var n=t[r];if(n.hueRange&&e>=n.hueRange[0]&&e<=n.hueRange[1])return t[r]}return"Color not found"}function i(t){if(null===e){var r=Math.random();return r+=.618033988749895,r%=1,Math.floor(t[0]+r*(t[1]+1-t[0]))}var n=t[1]||1,o=t[0]||0;return Math.floor(o+(e=(9301*e+49297)%233280)/233280*(n-o))}function s(e,r,n){var o=n[0][0],i=n[n.length-1][0],s=n[n.length-1][1],a=n[0][1];t[e]={hueRange:r,lowerBounds:n,saturationRange:[o,i],brightnessRange:[s,a]}}function a(e){var t=e[0];0===t&&(t=1),360===t&&(t=359),t/=360;var r=e[1]/100,n=e[2]/100,o=Math.floor(6*t),i=6*t-o,s=n*(1-r),a=n*(1-i*r),u=n*(1-(1-i)*r),c=256,l=256,p=256;switch(o){case 0:c=n,l=u,p=s;break;case 1:c=a,l=n,p=s;break;case 2:c=s,l=n,p=u;break;case 3:c=s,l=a,p=n;break;case 4:c=u,l=s,p=n;break;case 5:c=n,l=s,p=a}return[Math.floor(255*c),Math.floor(255*l),Math.floor(255*p),]}function u(e){var t=parseInt((e=3===(e=e.replace(/^#/,"")).length?e.replace(/(.)/g,"$1$1"):e).substr(0,2),16)/255,r=parseInt(e.substr(2,2),16)/255,n=parseInt(e.substr(4,2),16)/255,o=Math.max(t,r,n),i=o-Math.min(t,r,n),s=o?i/o:0;switch(o){case t:return[60*((r-n)/i%6)||0,s,o];case r:return[60*((n-t)/i+2)||0,s,o];case n:return[60*((t-r)/i+4)||0,s,o]}}function c(e){var t=e[0],r=e[1]/100,n=e[2]/100,o=(2-r)*n;return[t,Math.round(r*n/(o<1?o:2-o)*1e4)/100,o/2*100,]}return n})(),l&&l.exports&&(p=l.exports=$),p.randomColor=$;var g=t(d.exports);class y{constructor(e){if(this._onSourceChange=e=>{if("visibility"===e.sourceDataType||!e.isSourceLoaded)return;let t=Object.assign({},this.sources);this._setSourcesFromMap(),!n(t,this.sources)&&Object.keys(this.sources).length>0&&setTimeout(()=>this.render(),1e3)},this._onStyleChange=()=>{var e;let t=this._map.getStyle();(!(e=t).metadata||!e.metadata["maplibregl-inspect:inspect"])&&(this._originalStyle=t)},this._onRightClick=()=>{this.options.showMapPopupOnHover||this.options.showInspectMapPopupOnHover||this.options.blockHoverPopupOnClick||!this._popup||this._popup.remove()},this._onMousemove=e=>{if(this._showInspectMap){if(!this.options.showInspectMapPopup||"mousemove"===e.type&&!this.options.showInspectMapPopupOnHover)return;"click"===e.type&&this.options.showInspectMapPopupOnHover&&this.options.blockHoverPopupOnClick&&(this._popupBlocked=!this._popupBlocked)}else{if(!this.options.showMapPopup||"mousemove"===e.type&&!this.options.showMapPopupOnHover)return;"click"===e.type&&this.options.showMapPopupOnHover&&this.options.blockHoverPopupOnClick&&(this._popupBlocked=!this._popupBlocked)}if(!this._popupBlocked&&this._popup){let t;t=0===this.options.selectThreshold?e.point:[[e.point.x-this.options.selectThreshold,e.point.y+this.options.selectThreshold,],[e.point.x+this.options.selectThreshold,e.point.y-this.options.selectThreshold,]];let r=this._map.queryRenderedFeatures(t,this.options.queryParameters)||[];if(this._map.getCanvas().style.cursor=r.length?"pointer":"",r.length){this._popup.setLngLat(e.lngLat);let n=this.options.renderPopup(r);"string"==typeof n?this._popup.setHTML(n):this._popup.setDOMContent(n),this._popup.addTo(this._map)}else this._popup.remove()}},!(this instanceof y))throw Error("MaplibreInspect needs to be called with the new keyword");let t=null;window.maplibregl?t=new window.maplibregl.Popup({closeButton:!1,closeOnClick:!1}):e.popup||console.error("Maplibre GL JS can not be found. Make sure to include it or pass an initialized MaplibreGL Popup to MaplibreInspect if you are using moduleis."),this.options=Object.assign({showInspectMap:!1,showInspectButton:!0,showInspectMapPopup:!0,showMapPopup:!1,showMapPopupOnHover:!0,showInspectMapPopupOnHover:!0,blockHoverPopupOnClick:!1,backgroundColor:"#fff",assignLayerColor:function e(t,r){let n="bright",o;/water|ocean|lake|sea|river/.test(t)&&(o="blue"),/state|country|place/.test(t)&&(o="pink"),/road|highway|transport|streets/.test(t)&&(o="orange"),/contour|building|earth/.test(t)&&(o="monochrome"),/building/.test(t)&&(n="dark"),/earth/.test(t)&&(n="light"),/contour|landuse/.test(t)&&(o="yellow"),/wood|forest|park|landcover|land|natural/.test(t)&&(o="green");let i=g({luminosity:n,hue:o,seed:t,format:"rgbArray"});return`rgba(${i.join(", ")}, ${r||"1"})`},buildInspectStyle:a.generateInspectStyle,renderPopup:function e(t){var r;return`<div class="maplibregl-inspect_popup">${(r=t).map(e=>{var t;return`<div class="maplibregl-inspect_feature">${(t=e).id?[c(t.layer["source-layer"]||t.layer.source),u("id",t.id),u("type",t.geometry.type),].concat(Object.keys(t.properties).map(e=>u(e,t.properties[e]))).join(""):[c(t.layer["source-layer"]||t.layer.source),u("type",t.geometry.type),].concat(Object.keys(t.properties).map(e=>u(e,t.properties[e]))).join("")}</div>`}).join("")}</div>`},popup:t,selectThreshold:5,useInspectStyle:!0,queryParameters:{},sources:{},toggleCallback(){},manageStyleOutside:!1},e),this.sources=this.options.sources,this.assignLayerColor=this.options.assignLayerColor,this._popup=this.options.popup,this._popupBlocked=!1,this._showInspectMap=this.options.showInspectMap,this._toggle=new class e{constructor(e){e=Object.assign({show:!0,onToggle(){}},e),this._btn=this.createButton(),this._btn.onclick=e.onToggle,this.elem=this.createContainer(this._btn,e.show)}createButton(){let e=document.createElement("button");return e.className="maplibregl-ctrl-icon maplibregl-ctrl-inspect",e.type="button",e.setAttribute("aria-label","Inspect"),e}createContainer(e,t){let r=document.createElement("div");return r.className="maplibregl-ctrl maplibregl-ctrl-group",r.appendChild(e),t||(r.style.display="none"),r}setInspectIcon(){this._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-inspect"}setMapIcon(){this._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-map"}}({show:this.options.showInspectButton,onToggle:()=>this.toggleInspector()})}toggleInspector(){this._showInspectMap=!this._showInspectMap,this._popupBlocked=!1,this.options.toggleCallback(this._showInspectMap),this.render()}_inspectStyle(){let e=a.generateColoredLayers(this.sources,this.assignLayerColor);return this.options.buildInspectStyle(this._map.getStyle(),e,{backgroundColor:this.options.backgroundColor})}render(){if(this._showInspectMap){if(this.options.useInspectStyle){var e;this._map.setStyle(Object.assign(e=this._inspectStyle(),{metadata:Object.assign({},e.metadata,{"maplibregl-inspect:inspect":!0})}))}this._toggle.setMapIcon()}else this._originalStyle&&(this._popup&&this._popup.remove(),this.options.useInspectStyle&&this._map.setStyle(this._originalStyle),this._toggle.setInspectIcon())}_setSourcesFromMap(){let e=Object.keys(this._map.getStyle().sources);Object.keys(this._map.style.sourceCaches).forEach(e=>{let t=this._map.style.sourceCaches[e]||{_source:{}},r=t._source.vectorLayerIds;r?this.sources[e]=r:"geojson"===t._source.type&&(this.sources[e]=[])}),Object.keys(this.sources).forEach(t=>{-1===e.indexOf(t)&&delete this.sources[t]})}setOriginalStyle(e){this._originalStyle=e,this._setSourcesFromMap()}onAdd(e){return this._map=e,0===Object.keys(this.sources).length&&(e.on("tiledata",this._onSourceChange),e.on("sourcedata",this._onSourceChange)),e.on("styledata",this._onStyleChange),e.on("load",this._onStyleChange),e.on("mousemove",this._onMousemove),e.on("click",this._onMousemove),e.on("contextmenu",this._onRightClick),this._toggle.elem}onRemove(){this._map.off("styledata",this._onStyleChange),this._map.off("load",this._onStyleChange),this._map.off("tiledata",this._onSourceChange),this._map.off("sourcedata",this._onSourceChange),this._map.off("mousemove",this._onMousemove),this._map.off("click",this._onMousemove),this._map.off("contextmenu",this._onRightClick);let e=this._toggle.elem;e.parentNode.removeChild(e),this._map=void 0}}return y});